const REFRESH_PERIOD=6*3600*1000;const RESIZE_UPDATE_DELAY=500;let updateTimer=null;let resizeUpdateTimer=null;let startTimestamp=null;let endTimestamp=null;let userStrings=ajax_object.user_strings;let cpuUsageEnabled=ajax_object.cpu_usage;let diskUsageEnabled=ajax_object.disk_usage;let memoryUsageEnabled=ajax_object.memory_usage;let cpuValueType=ajax_object.cpu_value_type;let storageValueType=ajax_object.storage_value_type;let memoryValueType=ajax_object.memory_value_type;let defaultPlotFile=ajax_object.default_plot_file;let lastWasActive=false;function inesonicSpeedSentryEnableByClass(a,b){if(b){jQuery("."+a).attr("class",a+" inesonic-speedsentry-visible")}else{jQuery("."+a).attr("class",a+" inesonic-speedsentry-hidden")}}function inesonicSpeedSentryResourcesUpdatePlot(a,b,c,e,f,d){let totalWidth=jQuery(a).width();let totalHeight=jQuery(window).height()/4;let yAxisLabelWidth=jQuery(c).width();let xAxisLabelHeight=jQuery(b).height();let imageWidth=Math.min(2047,Math.round(totalWidth-yAxisLabelWidth));let imageHeight=Math.max(375,Math.min(1536,Math.round(totalHeight-xAxisLabelHeight)));request={action:"inesonic_speedsentry_resources_plot",value_type:f,scale_factor:d,title:"",x_axis_label:"",y_axis_label:"",width:imageWidth,height:imageHeight,format:"PNG"};jQuery.ajax({type:"POST",url:ajax_object.ajax_url,data:request,dataType:"json",success:function(g){let image=jQuery(e);if(g.status=="OK"){base64Image=g.image;image.attr("src","data:image/png;base64,"+base64Image)}else{image.attr("src",defaultPlotFile)}let currentTimestamp=(new Date()).getTime();image.prop("class","inesonic-speedsentry-resources-image dummy_class_"+currentTimestamp)},error:function(g,i,h){console.log("Could not retrieve plot: "+h)}})}function inesonicSpeedSentryResourcesUpdateCpuUsagePlot(){inesonicSpeedSentryResourcesUpdatePlot("#inesonic-speedsentry-resources-cpu-inner","#inesonic-speedsentry-resources-cpu-x-axis-label","#inesonic-speedsentry-resources-cpu-y-axis-label","#inesonic-speedsentry-resources-cpu-image",cpuValueType,100)}function inesonicSpeedSentryResourcesUpdateDiskUsagePlot(){inesonicSpeedSentryResourcesUpdatePlot("#inesonic-speedsentry-resources-disk-inner","#inesonic-speedsentry-resources-disk-x-axis-label","#inesonic-speedsentry-resources-disk-y-axis-label","#inesonic-speedsentry-resources-disk-image",storageValueType,1e-9)}function inesonicSpeedSentryResourcesUpdateMemoryUsagePlot(){inesonicSpeedSentryResourcesUpdatePlot("#inesonic-speedsentry-resources-memory-inner","#inesonic-speedsentry-resources-memory-x-axis-label","#inesonic-speedsentry-resources-memory-y-axis-label","#inesonic-speedsentry-resources-memory-image",memoryValueType,1)}function inesonicSpeedSentryResourcesUpdatePlots(){if(cpuUsageEnabled){inesonicSpeedSentryResourcesUpdateCpuUsagePlot()}if(diskUsageEnabled){inesonicSpeedSentryResourcesUpdateDiskUsagePlot()}if(memoryUsageEnabled){inesonicSpeedSentryResourcesUpdateMemoryUsagePlot()}}jQuery(window).resize(function(){if(resizeUpdateTimer!==null){clearTimeout(resizeUpdateTimer)}resizeUpdateTimer=setTimeout(function(){jQuery(this).trigger("windowResized")},RESIZE_UPDATE_DELAY)});jQuery(document).ready(function(a){a("#inesonic-speedsentry-resources-start-date").datepicker();a("#inesonic-speedsentry-resources-end-date").datepicker();jQuery("#inesonic-speedsentry-capabilities").on("inesonic-speedsentry-capabilities-changed",function(c,b){let isActive=false;if(b!==null){isActive=b.connected&&b.customer_active}inesonicSpeedSentryEnableByClass("inesonic-speedsentry-active",isActive);if(isActive!=lastWasActive){lastWasActive=isActive;inesonicSpeedSentryResourcesUpdatePlots()}});a("#inesonic-speedsentry-resources-start-date").on("change paste",function(){let newValue=a(this).val();startTimestamp=moment(moment(newValue).tz(moment.tz.guess()).utc().format()).unix();inesonicSpeedSentryResourcesUpdatePlots()});a("#inesonic-speedsentry-resources-end-date").on("change paste",function(){let newValue=a(this).val();endTimestamp=moment(moment(newValue).tz(moment.tz.guess()).utc().format()).unix();inesonicSpeedSentryResourcesUpdatePlots()});a("#inesonic-speedsentry-resources-start-clear-button").click(function(b){startTimestamp=null;a("#inesonic-speedsentry-resources-start-date").val("");inesonicSpeedSentryResourcesUpdatePlots()});a("#inesonic-speedsentry-resources-end-clear-button").click(function(b){endTimestamp=null;a("#inesonic-speedsentry-resources-end-date").val("");inesonicSpeedSentryResourcesUpdatePlots()});jQuery(window).bind("windowResized",inesonicSpeedSentryResourcesUpdatePlots)});